add_test(NAME generate_input_test COMMAND sh -c "gp -q generate_input.gp" WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})

add_executable(parse test_parse.c)
target_include_directories(parse PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(parse PRIVATE fp_poly)
add_test(NAME parse COMMAND parse)
add_test(NAME parse_memory COMMAND valgrind --leak-check=full ./parse)
set_tests_properties(parse_memory PROPERTIES TIMEOUT 10 PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")

add_executable(util test_util.c)
target_include_directories(util PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(util PRIVATE fp_poly)
add_test(NAME util COMMAND util)
add_test(NAME util_memory COMMAND valgrind --leak-check=full ./util)
set_tests_properties(util_memory PROPERTIES TIMEOUT 10 PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")

add_executable(addition test_add.c)
target_include_directories(addition PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(addition PRIVATE fp_poly)
#add_test(NAME addition COMMAND sh -c "gp -q generate_input.gp; ./addition")
add_test(NAME addition COMMAND ./addition)
add_test(NAME addition_memory COMMAND valgrind --leak-check=full ./addition)
set_tests_properties(addition_memory PROPERTIES TIMEOUT 10 PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")

add_executable(substraction test_sub.c)
target_include_directories(substraction PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(substraction PRIVATE fp_poly)
add_test(NAME substraction COMMAND substraction)
add_test(NAME substraction_memory COMMAND valgrind --leak-check=full ./substraction)
set_tests_properties(substraction_memory PROPERTIES TIMEOUT 10 PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")

add_executable(multiplication test_mul.c)
target_include_directories(multiplication PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(multiplication PRIVATE fp_poly)
add_test(NAME multiplication COMMAND multiplication)
add_test(NAME multiplication_memory COMMAND valgrind --leak-check=full ./multiplication)
set_tests_properties(multiplication_memory PROPERTIES PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")

add_executable(division test_div.c)
target_include_directories(division PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/fp_poly/include)
target_link_libraries(division PRIVATE fp_poly)
add_test(NAME division COMMAND division)
set_tests_properties(division PROPERTIES TIMEOUT 2)
add_test(NAME division_memory COMMAND valgrind --leak-check=full ./division)
set_tests_properties(division_memory PROPERTIES TIMEOUT 10 PASS_REGULAR_EXPRESSION "ERROR SUMMARY: 0 errors.*")